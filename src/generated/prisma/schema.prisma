generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

enum Category {
  FICTION
  NON_FICTION
  CHILDREN
  COMICS
  POETRY
  EDUCATIONAL
  REFERENCE
  RELIGION
  SCIENCE
  HISTORY
  ART
  HEALTH
  BUSINESS
}

enum Payment_Method {
  COD // Cash on Delivery
  POD // Pay on Delivery
}

model Avatar {
  id        String @id @default(cuid())
  url       String @default("https://placehold.co/600x400")
  localPath String @default("")
  userId    String @unique
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                          String   @id @default(cuid())
  username                    String   @default("johndoe007")
  fullName                    String   @default("John Doe")
  email                       String
  password                    String
  isEmailVerified             Boolean  @default(false)
  role                        Role     @default(USER)
  emailVerificationToken      String?
  resendEmailVerificationUrl  String?
  forgetVerificationToken     String?
  resendForgetVerificationUrl String?
  refreshToken                String?
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
  avatar                      Avatar?
  book                        Book[]
  review                      Review[]
  order                       Order[]
}

model BookCoverImageUrl {
  id     String @id @default(cuid())
  url    String @default("")
  bookId String @unique
  book   Book   @relation(fields: [bookId], references: [id], onDelete: Cascade)
}

model Book {
  id                   String             @id @default(cuid())
  userId               String
  book_title           String             @unique
  book_description     String
  book_price           Decimal            @db.Decimal(10, 2)
  book_publish_date    DateTime
  book_language        String
  book_publisher       String?
  book_pages           String?
  book_rating          Float?             @default(0)
  book_category        Category
  book_author_name     String
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  book_cover_image_url BookCoverImageUrl?
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  review               Review[]
  Order_Item           Order_Item[]
}

model Review {
  id          String   @id @default(cuid())
  bookId      String
  userId      String
  book_review String   @unique
  book        Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([bookId, userId])
}

model Order {
  id                 String         @id @default(cuid())
  ship_to            String
  payment_method     Payment_Method @default(POD)
  total_amount       Decimal        @db.Decimal(10, 2)
  grand_total_amount Decimal        @db.Decimal(10, 2)
  userId             String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order_item Order_Item[]
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Order_Item {
  id            String   @id @default(cuid())
  orderId       String
  bookId        String
  book_quantity Int      @default(1)
  book_price    Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  book  Book  @relation(fields: [bookId], references: [id], onDelete: Cascade)
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}
